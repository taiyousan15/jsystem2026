# 要件定義書（Requirements Definition Document）

**プロジェクト名**: ゲーミフィケーション会員サイト（GamiFi Members）
**バージョン**: 3.0.0
**作成日**: 2026-02-08
**改訂日**: 2026-02-08（ChatWork/Zoom/n8n統合要件追加）
**ステータス**: 承認待ち

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [ビジネス要件](#2-ビジネス要件)
3. [ユーザー要件](#3-ユーザー要件)
4. [機能要件](#4-機能要件)
5. [非機能要件](#5-非機能要件)
6. [データ要件](#6-データ要件)
7. [外部インターフェース要件](#7-外部インターフェース要件)（v3.0 ChatWork/Zoom/n8n追加）
8. [法的コンプライアンス要件](#8-法的コンプライアンス要件)（v2.0追加）
9. [セキュリティ要件](#9-セキュリティ要件)
10. [UI/UX要件](#10-uiux要件)
11. [運用・保守要件](#11-運用保守要件)
12. [制約事項・前提条件](#12-制約事項前提条件)
13. [用語集](#13-用語集)
14. [承認](#14-承認)

---

## 1. プロジェクト概要

### 1.1 背景と目的

コンサルティングコミュニティの会員エンゲージメント向上を目的として、ゲーミフィケーション要素を組み込んだ会員サイトを構築する。会員がサイト内アクション、グループコンサル（グルコン）、オフ会等のイベント参加を通じてコミュニティ独自の「マイル」を獲得し、商品やサービスと交換できる仕組みを提供する。

### 1.2 プロジェクトスコープ

| 区分 | 内容 |
|------|------|
| **スコープ内** | 会員登録・認証、マイルシステム、バッジ・ランキング・ティア、ポイント交換、イベント管理、管理画面、通知、分析ダッシュボード |
| **スコープ外** | ネイティブモバイルアプリ（PWAで対応）、動画配信基盤（外部サービス連携）、決済代行（Stripe利用） |

### 1.3 対象ユーザー

| ユーザー種別 | 説明 | 想定人数 |
|-------------|------|---------|
| 一般会員 | コミュニティ参加者 | 5,000〜6,000人 |
| 管理者 | コミュニティ運営スタッフ | 3〜10人 |
| スーパー管理者 | システム全権限保持者 | 1〜2人 |

### 1.4 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| DAU/MAU比率 | 40%以上 | Mixpanel |
| 平均セッション時間 | 15分以上 | Mixpanel |
| 7日リテンション率 | 30%以上 | コホート分析 |
| 月次解約率 | 10%未満 | 会員DB集計 |
| マイル利用率 | 会員の60%以上が月1回以上利用 | トランザクション分析 |
| NPS（推奨度） | 50以上 | 定期アンケート |

---

## 2. ビジネス要件

### 2.1 ビジネス目標

| ID | 目標 | 優先度 |
|----|------|--------|
| BG-001 | 会員のサイト内エンゲージメントを現状比200%向上 | 最高 |
| BG-002 | グルコン・オフ会の参加率を現状比150%向上 | 高 |
| BG-003 | 会員の月次継続率を90%以上に維持 | 最高 |
| BG-004 | 新規会員の口コミ紹介率を20%以上に | 中 |
| BG-005 | コミュニティ内の相互支援文化を醸成 | 高 |

### 2.2 ビジネスルール

| ID | ルール | 説明 |
|----|--------|------|
| BR-001 | マイルの有効期限 | 獲得日から12ヶ月。期限切れマイルは自動失効 |
| BR-002 | マイルの譲渡禁止 | 会員間のマイル移転は不可 |
| BR-003 | マイルの換金禁止 | マイルを現金に換金することは不可 |
| BR-004 | 不正取得の無効化 | 不正に取得されたマイルは管理者権限で無効化可能 |
| BR-005 | ティア降格猶予 | ティア評価はローリング12ヶ月。降格前に30日の猶予期間 |
| BR-006 | 退会時のマイル失効 | 退会時にマイル残高は全額失効 |
| BR-007 | 景品表示法遵守 | ポイント交換品は景品表示法の範囲内で設定 |
| BR-008 | 個人情報保護法遵守 | 会員情報の取り扱いは個人情報保護法に準拠 |

### 2.3 収益モデル

| 収益源 | 説明 |
|--------|------|
| 月額会員費 | 基本会員プランの月額課金（Stripe経由） |
| プレミアムプラン | 上位プランへのアップグレード課金 |
| イベント参加費 | 有料イベント（オフ会・特別グルコン）の参加費 |
| マイル購入（オプション） | マイルの直接購入（将来拡張） |

---

## 3. ユーザー要件

### 3.1 ユーザーストーリー（一般会員）

| ID | ストーリー | 優先度 | 受け入れ基準 |
|----|-----------|--------|-------------|
| US-001 | 会員として、メールまたはSNSアカウントでサイトにログインしたい | 最高 | Google/GitHub OAuth + メール認証が使える |
| US-002 | 会員として、自分のマイル残高と獲得履歴をダッシュボードで確認したい | 最高 | リアルタイムで残高表示、直近30日の履歴一覧 |
| US-003 | 会員として、サイト内のアクション（閲覧・コメント・課題提出等）でマイルを自動獲得したい | 最高 | アクション完了後3秒以内にマイル付与通知 |
| US-004 | 会員として、グルコン・オフ会参加時にQRコードスキャンでマイルを獲得したい | 高 | QRコード読取→即座にマイル付与→画面表示 |
| US-005 | 会員として、獲得したマイルを商品・サービスと交換したい | 最高 | 交換カタログから選択→確認→即時反映 |
| US-006 | 会員として、ランキングで自分の順位を確認したい | 高 | 週間/月間/全期間のランキング表示 |
| US-007 | 会員として、バッジを獲得して自分のプロフィールに表示したい | 中 | 条件達成時に自動付与+ポップアップ通知 |
| US-008 | 会員として、連続ログインでストリークボーナスを得たい | 高 | 連続日数表示+ボーナスマイル自動付与 |
| US-009 | 会員として、自分のティア（ランク）を確認し次ランクまでの進捗を見たい | 高 | 現在ティア+プログレスバー+残り必要マイル表示 |
| US-010 | 会員として、デイリーミッションに挑戦してボーナスマイルを得たい | 中 | 毎日3つのミッション提示、達成でボーナス |
| US-011 | 会員として、友達を招待してボーナスマイルを得たい | 中 | 招待リンク生成→友人登録完了→500マイル付与 |
| US-012 | 会員として、プッシュ通知でマイル獲得やイベント案内を受け取りたい | 中 | ブラウザプッシュ通知+メール通知（設定可能） |
| US-013 | 会員として、スマートフォンでも快適に利用したい | 高 | レスポンシブ対応、PWAインストール可能 |
| US-014 | 会員として、他メンバーの質問に回答してマイルを得たい | 高 | 回答投稿→質問者がベストアンサー選定→30マイル付与 |
| US-015 | 会員として、シーズンイベントで限定バッジ・報酬を獲得したい | 低 | 四半期ごとのシーズンイベント開催 |

### 3.2 ユーザーストーリー（管理者）

| ID | ストーリー | 優先度 | 受け入れ基準 |
|----|-----------|--------|-------------|
| US-101 | 管理者として、会員のマイル残高を手動で調整したい | 最高 | 加算/減算/理由記入が可能、監査ログ記録 |
| US-102 | 管理者として、イベント（グルコン・オフ会）を作成・管理したい | 最高 | イベント作成→QRコード自動生成→参加者管理 |
| US-103 | 管理者として、交換カタログの商品を追加・編集・削除したい | 高 | 商品名/画像/必要マイル/在庫数の管理 |
| US-104 | 管理者として、バッジの作成・条件設定をしたい | 中 | ノーコードでバッジ名/アイコン/獲得条件を設定 |
| US-105 | 管理者として、ダッシュボードでKPIを確認したい | 高 | DAU/MAU、マイル流通量、交換率等をグラフ表示 |
| US-106 | 管理者として、不正行為を検知・対処したい | 高 | 異常なマイル獲得パターンのアラート+会員BANnage |
| US-107 | 管理者として、一括通知を会員に送信したい | 中 | 全体/セグメント別の通知配信 |
| US-108 | 管理者として、マイル獲得ルールを変更したい | 高 | 管理画面からアクション別ポイント値を変更可能 |
| US-109 | 管理者として、交換申請の承認・発送管理をしたい | 高 | 物理商品の交換申請→承認→発送ステータス管理 |
| US-110 | 管理者として、会員情報を検索・閲覧したい | 高 | 名前/メール/ティアでの検索+詳細プロフィール表示 |

### 3.3 ユーザーペルソナ

#### ペルソナA: アクティブ学習者（35歳・男性・会社員）
- **目標**: スキルアップ、コミュニティでの認知度向上
- **行動**: 毎日ログイン、コンテンツ閲覧、質問回答に積極的
- **動機**: ティアアップ、限定コンテンツアクセス
- **課題**: 忙しくてイベント参加が限定的

#### ペルソナB: イベント重視型（42歳・女性・個人事業主）
- **目標**: 人脈構築、ビジネスパートナー探し
- **行動**: グルコン・オフ会に積極参加、サイト利用は週2-3回
- **動機**: オフ会参加マイル、VIPイベント招待
- **課題**: オンラインでの活動が少ない

#### ペルソナC: ROM専（28歳・男性・フリーランス）
- **目標**: 情報収集
- **行動**: コンテンツ閲覧のみ、投稿・イベント参加はほぼなし
- **動機**: デイリーミッションで少しずつマイルを貯めたい
- **課題**: コミュニティ参加への心理的ハードル

---

## 4. 機能要件

### 4.1 認証・会員管理（AUTH）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| AUTH-001 | メール認証 | メール+パスワードによるサインアップ/ログイン | 最高 |
| AUTH-002 | ソーシャルログイン | Google, GitHub OAuthプロバイダー | 最高 |
| AUTH-003 | マジックリンク | メールワンタイムリンクによるパスワードレスログイン | 高 |
| AUTH-004 | セッション管理 | JWT + リフレッシュトークン、30日間有効 | 最高 |
| AUTH-005 | プロフィール管理 | 表示名、アバター、自己紹介、SNSリンクの編集 | 高 |
| AUTH-006 | パスワードリセット | メールによるパスワードリセットフロー | 最高 |
| AUTH-007 | 多要素認証（MFA） | TOTP（Google Authenticator等）による2段階認証 | 中 |
| AUTH-008 | ロールベースアクセス制御 | member / admin / super_admin の3ロール | 最高 |
| AUTH-009 | 退会処理 | 会員自身による退会申請→30日猶予→データ削除 | 高 |
| AUTH-010 | ログイン履歴 | 直近のログイン日時・IPアドレス・デバイス表示 | 中 |

### 4.2 マイルシステム（MILE）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| MILE-001 | マイル獲得 | 定義されたアクション完了時に自動でマイル加算 | 最高 |
| MILE-002 | マイル消費 | 交換申請時にマイル残高から減算 | 最高 |
| MILE-003 | マイル残高照会 | 現在の有効マイル残高をリアルタイム表示 | 最高 |
| MILE-004 | マイル履歴 | 獲得/消費の全トランザクション履歴表示（ページング対応） | 高 |
| MILE-005 | マイル有効期限管理 | 獲得日から12ヶ月で自動失効。失効30日前に通知 | 高 |
| MILE-006 | 重複獲得防止 | 同一アクションの短時間連続実行によるマイル二重獲得防止 | 最高 |
| MILE-007 | トランザクション原子性 | マイル加減算はデータベーストランザクションで原子的に実行 | 最高 |
| MILE-008 | マイル獲得ルール管理 | 管理画面からアクション別マイル値を動的に変更可能 | 高 |
| MILE-009 | ボーナスマイル | 期間限定のマイル倍率キャンペーン機能 | 中 |
| MILE-010 | マイル手動調整 | 管理者による手動加算/減算（監査ログ必須） | 高 |

#### マイル獲得ルール一覧

| アクションコード | アクション名 | 基本マイル | 日次上限 | 条件 |
|----------------|------------|-----------|---------|------|
| `daily_login` | デイリーログイン | 5 | 1回 | 1日1回、0:00 JSTリセット |
| `content_view` | コンテンツ閲覧完了 | 10 | 100マイル | 閲覧時間が60秒以上 |
| `comment_post` | コメント投稿 | 15 | 10回 | 10文字以上のコメント |
| `task_submit` | 課題提出 | 50 | なし | 管理者が承認した課題 |
| `help_answer` | 他メンバーへの回答 | 30 | 5回 | ベストアンサーに選定された場合 |
| `group_consult` | グルコン参加 | 100 | なし | QRコードスキャンで確認 |
| `offline_event` | オフ会参加 | 200 | なし | QRコードスキャンで確認 |
| `sns_share` | SNS公式ハッシュタグ投稿 | 25 | 1回 | ハッシュタグ検出で自動付与 |
| `referral` | 友達招待成功 | 500 | なし | 招待された友人の登録完了時 |
| `monthly_mvp` | 月間MVP | 1,000 | 月1回 | 管理者が選定 |
| `streak_bonus_7` | 7日連続ログイン | 50 | なし | 7日連続ログイン達成時 |
| `streak_bonus_30` | 30日連続ログイン | 300 | なし | 30日連続ログイン達成時 |
| `daily_mission` | デイリーミッション達成 | 20 | 3回 | 1日3つのミッション |
| `profile_complete` | プロフィール完成 | 100 | 1回 | 全項目入力（1回限り） |

### 4.3 ティアシステム（TIER）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| TIER-001 | ティア判定 | 累計獲得マイル（ローリング12ヶ月）に基づくティア自動判定 | 高 |
| TIER-002 | ティア昇格通知 | ティア昇格時にアニメーション付きポップアップ+プッシュ通知 | 高 |
| TIER-003 | ティア降格警告 | 降格30日前に警告通知、あと何マイルで維持可能か表示 | 中 |
| TIER-004 | ティア特典管理 | ティア別のアクセス権限・特典の管理 | 高 |
| TIER-005 | プログレスバー | 次のティアまでの進捗をプログレスバーで表示 | 高 |

#### ティア定義

| ティア | 累計マイル（12ヶ月） | 特典 | アイコン色 |
|-------|-------------------|------|----------|
| ブロンズ | 0〜999 | 基本コンテンツアクセス | #CD7F32 |
| シルバー | 1,000〜4,999 | +限定コンテンツ +月1回Q&A優先枠 | #C0C0C0 |
| ゴールド | 5,000〜14,999 | +限定Discordチャンネル +月2回Q&A優先枠 | #FFD700 |
| プラチナ | 15,000〜49,999 | +月1回個別相談15分 +イベント優先予約 | #E5E4E2 |
| ダイヤモンド | 50,000以上 | +VIPオフ会招待 +新サービス先行体験 +専用サポート | #B9F2FF |

### 4.4 バッジシステム（BADGE）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| BADGE-001 | バッジ自動付与 | 定義された条件達成時に自動でバッジ付与 | 高 |
| BADGE-002 | バッジ一覧表示 | 全バッジ一覧（獲得済/未獲得）をプロフィールに表示 | 高 |
| BADGE-003 | バッジ獲得通知 | 獲得時にアニメーション付きポップアップ表示 | 中 |
| BADGE-004 | バッジ管理 | 管理画面からバッジの追加・条件編集・削除 | 中 |
| BADGE-005 | レアリティ設定 | コモン/レア/エピック/レジェンダリーの4段階 | 低 |

#### 初期バッジ定義（30種）

**初心者カテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| ファーストステップ | 初回ログイン | コモン |
| 自己紹介完了 | プロフィール全項目入力 | コモン |
| はじめてのコメント | 初回コメント投稿 | コモン |
| 初交換 | 初回マイル交換 | コモン |
| ウェルカム | 会員登録後7日以内に5つのアクション完了 | レア |

**学習カテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| 読書家 | コンテンツ50件閲覧 | コモン |
| 学者 | コンテンツ200件閲覧 | レア |
| 博士 | コンテンツ500件閲覧 | エピック |
| 課題マスター | 課題10件提出 | レア |
| 完全制覇 | 全コンテンツ閲覧完了 | レジェンダリー |

**貢献カテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| ヘルパー | 他メンバーへの回答10件 | コモン |
| メンター | 他メンバーへの回答50件 | レア |
| 導師 | 他メンバーへの回答100件 | エピック |
| コメンテーター | コメント100件投稿 | レア |
| コミュニティの柱 | 回答200件+ベストアンサー50件 | レジェンダリー |

**イベントカテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| 初参加 | 初回イベント参加 | コモン |
| イベント好き | イベント5回参加 | コモン |
| パーティーアニマル | イベント20回参加 | レア |
| グルコンマスター | グルコン10回参加 | レア |
| レジェンドメンバー | イベント50回参加 | レジェンダリー |

**ストリークカテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| 3日連続 | 3日連続ログイン | コモン |
| 7日連続 | 7日連続ログイン | コモン |
| 30日連続 | 30日連続ログイン | レア |
| 100日連続 | 100日連続ログイン | エピック |
| 365日連続 | 365日連続ログイン | レジェンダリー |

**特別カテゴリ（5種）**

| バッジ名 | 条件 | レアリティ |
|---------|------|----------|
| 創設メンバー | サービスローンチ時の登録者 | レジェンダリー |
| 招待王 | 友達招待10人達成 | エピック |
| ダイヤモンド到達 | ダイヤモンドティア初到達 | レジェンダリー |
| シーズンチャンピオン | シーズンランキング1位 | レジェンダリー |
| 月間MVP | 月間MVPに選出 | エピック |

### 4.5 ランキングシステム（RANK）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| RANK-001 | 週間ランキング | 週間マイル獲得数ランキング（月曜0:00リセット） | 高 |
| RANK-002 | 月間ランキング | 月間マイル獲得数ランキング | 高 |
| RANK-003 | 全期間ランキング | 累計マイル獲得数ランキング | 中 |
| RANK-004 | 順位変動表示 | 前回順位との差分（↑↓→）を表示 | 中 |
| RANK-005 | 自分の順位ハイライト | ランキング内で自分の位置をハイライト表示 | 高 |
| RANK-006 | ランキング報酬 | 月間Top10にボーナスマイル付与 | 中 |
| RANK-007 | フレンドランキング | 友達限定のランキング表示 | 低 |

### 4.6 ストリークシステム（STREAK）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| STREAK-001 | 連続ログイン記録 | 日次のログイン有無を記録、連続日数をカウント | 高 |
| STREAK-002 | ストリーク表示 | 現在の連続日数と最長記録をダッシュボードに表示 | 高 |
| STREAK-003 | ストリークボーナス | 7日:50マイル / 30日:300マイル / 100日:1,000マイル | 高 |
| STREAK-004 | ストリークフリーズ | 月2回まで途切れを防止（追加購入:200マイル/回） | 中 |
| STREAK-005 | タイムゾーン対応 | JST基準で日次判定（0:00〜23:59） | 最高 |
| STREAK-006 | ストリーク途切れ通知 | 当日未ログインの場合、21:00 JSTにリマインド通知 | 中 |

### 4.7 デイリーミッション（MISSION）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| MISSION-001 | ミッション生成 | 毎日0:00 JSTに3つのミッションを自動生成 | 中 |
| MISSION-002 | ミッション進捗 | 各ミッションの達成状況をリアルタイム表示 | 中 |
| MISSION-003 | ミッション達成報酬 | 各ミッション達成で20マイル、全3つ達成でボーナス30マイル | 中 |
| MISSION-004 | AIパーソナライズ | ユーザーの行動履歴に基づいたミッション提案（Phase 2） | 低 |

#### ミッションプール（ランダム選出）

| ミッション | 条件 |
|-----------|------|
| 今日のおすすめ記事を読もう | 指定コンテンツの閲覧完了 |
| コメントを1つ投稿しよう | コメント1件投稿 |
| 誰かの質問に回答しよう | 回答1件投稿 |
| プロフィールを更新しよう | プロフィール編集保存 |
| 3つのコンテンツを閲覧しよう | コンテンツ3件閲覧 |
| イベントページをチェックしよう | イベント一覧ページ訪問 |
| 友達に招待リンクを送ろう | 招待リンクのコピーまたはシェア |

### 4.8 マイル交換システム（EXCHANGE）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| EX-001 | 交換カタログ表示 | 交換可能な商品・サービス一覧をカタログ表示 | 最高 |
| EX-002 | 交換申請 | 商品選択→必要マイル確認→交換確定フロー | 最高 |
| EX-003 | 在庫管理 | 物理商品の在庫数管理、在庫切れ表示 | 高 |
| EX-004 | 交換履歴 | 過去の交換履歴一覧表示（ステータス含む） | 高 |
| EX-005 | 配送先管理 | 物理商品用の配送先住所登録・管理 | 高 |
| EX-006 | デジタル商品即時配信 | デジタル商品はマイル消費後に即時ダウンロード/アクセス付与 | 高 |
| EX-007 | 交換承認フロー | 物理商品: 申請→管理者承認→発送→完了 | 高 |
| EX-008 | 交換キャンセル | 発送前であれば会員自身がキャンセル可能（マイル返還） | 中 |

#### 交換カタログカテゴリ

| カテゴリ | 商品例 | 必要マイル範囲 |
|---------|--------|--------------|
| 物理商品 | オリジナルTシャツ、書籍、グッズ | 500〜5,000 |
| デジタル商品 | 限定PDF、テンプレート、動画 | 200〜2,000 |
| サービス | 個別コンサル30分/60分 | 3,000〜10,000 |
| 権限 | VIPルームアクセス（1ヶ月）、優先予約権 | 2,000〜5,000 |
| 割引 | 次回講座割引クーポン（10%/20%/30%） | 1,000〜3,000 |
| 体験 | VIPオフ会招待枠、特別グルコン参加枠 | 5,000〜15,000 |

### 4.9 イベント管理（EVENT）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| EVT-001 | イベント作成 | グルコン/オフ会のイベント作成（日時/場所/定員/マイル） | 最高 |
| EVT-002 | イベント一覧 | 今後のイベントをカレンダー/リスト表示 | 高 |
| EVT-003 | イベント参加登録 | 会員によるイベント参加登録（定員管理） | 最高 |
| EVT-004 | QRコード生成 | イベントごとにユニークなQRコード自動生成 | 高 |
| EVT-005 | QRコードスキャン | 会員のスマホカメラでQRコードスキャン→マイル即時付与 | 高 |
| EVT-006 | 参加者管理 | イベント参加者一覧、出欠確認 | 高 |
| EVT-007 | リマインド通知 | イベント1日前/1時間前にリマインド通知 | 中 |
| EVT-008 | イベント履歴 | 過去のイベント参加履歴表示 | 中 |
| EVT-009 | ティア別優先予約 | プラチナ以上は一般公開前に予約可能 | 中 |
| EVT-010 | 有料イベント対応 | Stripe経由で参加費決済 | 高 |

### 4.10 通知システム（NOTIF）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| NOTIF-001 | アプリ内通知 | サイト内通知ベル+通知一覧画面 | 最高 |
| NOTIF-002 | プッシュ通知 | PWA Service Workerによるブラウザプッシュ通知 | 高 |
| NOTIF-003 | メール通知 | 重要イベント（ティア昇格、交換承認等）のメール通知 | 高 |
| NOTIF-004 | 通知設定 | カテゴリ別の通知ON/OFF設定 | 中 |
| NOTIF-005 | 既読管理 | 通知の既読/未読管理 | 高 |
| NOTIF-006 | リアルタイム配信 | SSE（Server-Sent Events）によるリアルタイム通知 | 高 |

#### 通知トリガー一覧

| トリガー | 通知チャネル | 内容 |
|---------|------------|------|
| マイル獲得 | アプリ内 | 「+10マイル獲得！（コンテンツ閲覧）」 |
| ティア昇格 | アプリ内+プッシュ+メール | 「ゴールドティアに昇格しました！」 |
| バッジ獲得 | アプリ内+プッシュ | 「バッジ『読書家』を獲得！」 |
| ストリーク達成 | アプリ内+プッシュ | 「7日連続ログイン達成！50マイルボーナス！」 |
| ストリーク危機 | プッシュ | 「今日まだログインしていません。ストリークを守ろう！」 |
| 交換承認 | アプリ内+メール | 「交換申請が承認されました」 |
| イベントリマインド | プッシュ+メール | 「明日のグルコンをお忘れなく！」 |
| マイル失効予告 | メール | 「30日後に200マイルが失効します」 |
| デイリーミッション更新 | プッシュ | 「今日のミッションが更新されました！」 |
| ランキング変動 | アプリ内 | 「月間ランキングが5位→3位に上昇！」 |
| 管理者一括通知 | プッシュ+メール | 管理者が設定した内容 |

### 4.11 管理画面（ADMIN）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| ADM-001 | ダッシュボード | KPI一覧（DAU/MAU、マイル流通量、交換数等） | 高 |
| ADM-002 | 会員管理 | 会員一覧/検索/詳細表示/マイル調整/BAN | 最高 |
| ADM-003 | イベント管理 | イベントCRUD、QRコード管理、参加者管理 | 最高 |
| ADM-004 | 交換管理 | 交換申請一覧、承認/却下、発送ステータス更新 | 高 |
| ADM-005 | カタログ管理 | 交換カタログの商品CRUD、在庫管理 | 高 |
| ADM-006 | バッジ管理 | バッジCRUD、条件設定 | 中 |
| ADM-007 | マイルルール管理 | アクション別マイル値、ボーナス倍率設定 | 高 |
| ADM-008 | 通知管理 | 一括通知送信、通知テンプレート管理 | 中 |
| ADM-009 | 分析レポート | マイル流通/消費レポート、会員アクティビティレポート | 中 |
| ADM-010 | 監査ログ | 管理者操作の全ログ記録・閲覧 | 高 |
| ADM-011 | シーズン管理 | シーズンの開始/終了、限定バッジ/報酬設定 | 低 |

### 4.12 友達招待システム（REFERRAL）

| ID | 機能 | 詳細 | 優先度 |
|----|------|------|--------|
| REF-001 | 招待リンク生成 | 会員ごとにユニークな招待URLを自動生成 | 中 |
| REF-002 | 招待トラッキング | 招待リンク経由の登録を追跡 | 中 |
| REF-003 | 招待報酬 | 招待者:500マイル、被招待者:100マイルの両者付与 | 中 |
| REF-004 | 招待実績表示 | 招待成功数、獲得マイル合計の表示 | 低 |
| REF-005 | 不正防止 | 同一IP/デバイスからの連続招待を制限 | 中 |

---

## 5. 非機能要件

### 5.1 パフォーマンス要件

| ID | 要件 | 目標値 |
|----|------|--------|
| PERF-001 | ページ初期表示速度 | LCP（Largest Contentful Paint）: 2.5秒以内 |
| PERF-002 | API応答時間 | 95パーセンタイルで200ms以内 |
| PERF-003 | マイル付与レイテンシ | アクション完了から3秒以内にUI反映 |
| PERF-004 | リーダーボード更新 | 5秒以内の準リアルタイム更新 |
| PERF-005 | 同時接続ユーザー数 | 1,000人同時接続で性能劣化なし |
| PERF-006 | 月間ページビュー処理能力 | 500万PV/月を処理可能 |
| PERF-007 | データベースクエリ | 95パーセンタイルで50ms以内 |
| PERF-008 | 画像最適化 | 次世代フォーマット（WebP/AVIF）による自動変換 |

### 5.2 可用性要件

| ID | 要件 | 目標値 |
|----|------|--------|
| AVAIL-001 | 稼働率 | 99.9%（月間ダウンタイム43分以内） |
| AVAIL-002 | 計画メンテナンス | 月1回、深夜2:00-5:00 JSTに実施 |
| AVAIL-003 | 障害復旧時間（RTO） | 1時間以内 |
| AVAIL-004 | データ復旧地点（RPO） | 1時間以内（1時間分のデータ損失許容） |
| AVAIL-005 | バックアップ | 日次フルバックアップ + 1時間ごとの増分バックアップ |

### 5.3 スケーラビリティ要件

| ID | 要件 | 目標値 |
|----|------|--------|
| SCALE-001 | 水平スケーリング | アプリケーションサーバーの水平スケール対応 |
| SCALE-002 | 会員数スケール | 初期5,000人→将来50,000人まで対応可能な設計 |
| SCALE-003 | データ量スケール | 3年間のトランザクション履歴を性能劣化なく保持 |
| SCALE-004 | 自動スケーリング | Vercelのサーバーレス自動スケール活用 |

### 5.4 互換性要件

| ID | 要件 | 目標値 |
|----|------|--------|
| COMPAT-001 | ブラウザ対応 | Chrome/Safari/Firefox/Edge 最新2バージョン |
| COMPAT-002 | モバイル対応 | iOS 15+ / Android 12+ |
| COMPAT-003 | レスポンシブ | 320px〜2560pxの画面幅に対応 |
| COMPAT-004 | PWA | Service Worker、オフライン基本表示、ホーム画面追加 |

### 5.5 アクセシビリティ要件

| ID | 要件 | 目標値 |
|----|------|--------|
| A11Y-001 | WCAG準拠 | WCAG 2.1 Level AA準拠 |
| A11Y-002 | キーボード操作 | 全機能がキーボードのみで操作可能 |
| A11Y-003 | スクリーンリーダー | 主要機能がスクリーンリーダーで利用可能 |
| A11Y-004 | カラーコントラスト | テキストと背景のコントラスト比4.5:1以上 |

### 5.6 国際化要件

| ID | 要件 | 目標値 |
|----|------|--------|
| I18N-001 | デフォルト言語 | 日本語 |
| I18N-002 | タイムゾーン | JST（Asia/Tokyo）基準 |
| I18N-003 | 将来的な多言語対応 | i18n対応のアーキテクチャ設計（初期は日本語のみ） |

---

## 6. データ要件

### 6.1 データ保持ポリシー

| データ種別 | 保持期間 | 削除方法 |
|-----------|---------|---------|
| 会員情報 | 退会後30日 | 退会申請→30日猶予→物理削除 |
| マイルトランザクション | 無期限（監査目的） | 退会時は匿名化処理 |
| ログイン履歴 | 1年間 | 自動パージ |
| 通知データ | 90日間 | 自動パージ |
| 監査ログ | 3年間 | 自動アーカイブ→5年後削除 |
| バックアップ | 30日間 | 自動ローテーション |

### 6.2 データ量見積もり

| データ種別 | 1レコードサイズ | 月間増加数（5,000人） | 年間データ量 |
|-----------|---------------|---------------------|------------|
| ユーザー | 2KB | 100件（新規登録） | 2.4MB |
| マイルトランザクション | 500B | 500,000件 | 3GB |
| 通知 | 300B | 1,000,000件 | 3.6GB |
| イベント | 5KB | 20件 | 1.2MB |
| バッジ付与 | 200B | 50,000件 | 120MB |
| 監査ログ | 1KB | 10,000件 | 120MB |
| **合計** | | | **約7GB/年** |

### 6.3 データバックアップ要件

| 項目 | 要件 |
|------|------|
| バックアップ方式 | Supabase自動バックアップ（Pro以上） |
| バックアップ頻度 | 日次フルバックアップ + PITR（Point-in-Time Recovery） |
| バックアップ保持 | 30日間 |
| リストアテスト | 月1回のリストア訓練 |
| バックアップ先 | Supabaseマネージド（別リージョン複製） |

---

## 7. 外部インターフェース要件

### 7.1 外部サービス連携

| サービス | 用途 | 連携方式 | 優先度 |
|---------|------|---------|--------|
| Clerk | 認証・ユーザー管理 | SDK/REST API | 最高 |
| Supabase | データベース・リアルタイム | SDK/REST API | 最高 |
| Stripe | 決済・サブスクリプション | SDK/Webhook | 高 |
| Upstash Redis | キャッシュ・リーダーボード | REST API | 高 |
| Postmark | メール送信 | REST API | 高 |
| Firebase FCM | プッシュ通知 | SDK | 中 |
| Cloudinary | 画像管理 | SDK/REST API | 中 |
| Posthog（Self-Host推奨） | アナリティクス | SDK/Self-Host API | 中 |
| **ChatWork** | **コミュニティチャット活動計測・Bot通知** | **REST API v2 / Webhook** | **高** |
| **Zoom** | **グルコン参加追跡・投票・Q&A・録画** | **REST API / Webhook / OAuth 2.0** | **高** |
| **n8n（Self-Host）** | **ワークフロー自動化（ChatWork↔Zoom↔会員サイト）** | **REST API / Webhook** | **中** |

### 7.2 ChatWork API連携要件

#### 7.2.1 ChatWork Bot要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| CW-001 | Webhook受信 | `message_created` イベントをリアルタイム受信し、投稿を活動ログに記録 | 最高 |
| CW-002 | マイル確認Bot | 会員が `/マイル` と投稿すると残高・ランク・次ランクまでの差分を自動返信 | 高 |
| CW-003 | ランキングBot | `/ランキング` で月間トップ10を自動返信 | 中 |
| CW-004 | バッジBot | `/バッジ` で獲得済みバッジ一覧を自動返信 | 中 |
| CW-005 | ミッションBot | `/ミッション` で当日のデイリーミッションを自動返信 | 中 |

#### 7.2.2 ChatWork活動計測要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| CW-101 | メッセージ投稿計測 | Webhook + `GET /rooms/{id}/messages` で投稿数を日次集計 | 最高 |
| CW-102 | 返信パース | メッセージ本文の `[rp]` タグ解析で返信数を計測 | 高 |
| CW-103 | メンションパース | `[To:xxx]` タグ解析でメンション送受信を計測 | 高 |
| CW-104 | ポジティブワード検出 | 「ありがとう」「参考になりました」等の定型句を検出しスコア化 | 中 |
| CW-105 | URL共有検出 | メッセージ内のURL検出で情報共有活動を計測 | 中 |
| CW-106 | タスク完了追跡 | `PUT /rooms/{id}/tasks/{id}/status` で完了率・遵守率を計測 | 高 |
| CW-107 | ファイル共有追跡 | `GET /rooms/{id}/files` でアップロード数を計測 | 中 |
| CW-108 | 会員ID紐付け | ChatWork `account_id` と会員サイト `userId` のマッピング管理 | 最高 |

#### 7.2.3 ChatWork自動通知要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| CW-201 | グルコン告知 | Zoom会議作成時にChatWorkへ自動告知（日時・参加URL・獲得マイル） | 高 |
| CW-202 | グルコン結果通知 | グルコン終了後に参加者へ獲得マイル・累計を個別通知 | 高 |
| CW-203 | 日次ランキング | 毎日23:00に当日の活動ランキングを全体チャットへ投稿 | 中 |
| CW-204 | 週次レポート | 毎週月曜9:00に週間サマリーを全体チャットへ投稿 | 中 |
| CW-205 | バッジ獲得通知 | 会員がバッジ獲得時にChatWorkで全体発表 | 中 |
| CW-206 | 見逃し配信通知 | Zoom録画完了時に視聴URLをChatWorkへ投稿 | 高 |

### 7.3 Zoom API連携要件

#### 7.3.1 Zoom参加追跡要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| ZM-001 | Webhook受信（参加） | `meeting.participant_joined` でリアルタイム参加検知 | 最高 |
| ZM-002 | Webhook受信（退出） | `meeting.participant_left` で退出検知・滞在時間計算 | 最高 |
| ZM-003 | 参加レポート取得 | `GET /report/meetings/{id}/participants` で最終確定データ取得 | 最高 |
| ZM-004 | 段階マイル計算 | 参加時間に応じたマイル付与（30分未満:0pt / 30-59分:50pt / 60分+:100pt / 全時間:150pt） | 最高 |
| ZM-005 | ブレイクアウトルーム追跡 | `participant_left_breakout_room` Webhookでグループワーク参加記録 | 中 |
| ZM-006 | 会員ID紐付け | Zoom `email` / `registrant_id` と会員サイト `userId` のマッピング管理 | 最高 |

#### 7.3.2 Zoom投票・Q&A・アンケート要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| ZM-101 | 投票（Poll）結果取得 | `GET /report/meetings/{id}/polls` で投票結果を取得 | 高 |
| ZM-102 | 理解度テスト判定 | Poll正答率に応じたボーナスマイル付与（参加:10pt / 正答:20pt/問 / 全問正解:+50pt） | 高 |
| ZM-103 | Q&A記録取得 | `GET /report/meetings/{id}/qa` で質問・回答を取得 | 中 |
| ZM-104 | Q&A貢献マイル | 質問投稿:10pt / 回答投稿:15pt | 中 |
| ZM-105 | アンケート（Survey）取得 | `GET /report/meetings/{id}/surveys` で満足度データ取得 | 中 |
| ZM-106 | アンケート回答マイル | アンケート回答完了で5pt | 中 |

#### 7.3.3 Zoom録画・見逃し配信要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| ZM-201 | 録画完了検知 | `recording.completed` Webhookで自動検知 | 高 |
| ZM-202 | 録画URL取得 | `GET /meetings/{id}/recordings` でダウンロード/再生URLを取得 | 高 |
| ZM-203 | 会員サイト掲載 | 見逃し配信ページに自動掲載（タイトル・日時・再生リンク） | 高 |
| ZM-204 | 視聴追跡 | 会員サイト内での再生開始/完了をトラッキングし、視聴完了で20pt | 中 |
| ZM-205 | AI会議サマリー | `GET /meetings/{id}/summary`（AI Companion有効時）で要約を自動取得・掲載 | 低 |

#### 7.3.4 Zoom会議管理要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| ZM-301 | 会議作成 | 管理画面からZoom会議を作成し、イベントとして自動登録 | 高 |
| ZM-302 | 参加者登録連携 | 会員サイトのイベント参加登録→Zoom Registrant自動追加 | 中 |
| ZM-303 | 会議一覧表示 | 今後のグルコン/セミナー一覧を会員サイトに表示 | 高 |

### 7.4 n8n ワークフロー自動化要件

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| N8N-001 | グルコン自動管理 | Zoom meeting.ended → 参加者集計 → マイル付与 → ChatWork通知の全自動化 | 高 |
| N8N-002 | ChatWork活動量日次集計 | 毎日23:00にメッセージ取得→メンバー別集計→DB保存→ランキング投稿 | 高 |
| N8N-003 | 見逃し配信自動公開 | recording.completed → URL取得 → DB保存 → ChatWork通知 | 高 |
| N8N-004 | 週次レポート自動生成 | 毎週月曜9:00に週間集計→レポート生成→ChatWork投稿 | 中 |
| N8N-005 | セルフホスト | n8nをDockerでセルフホスト（データの日本国内保管） | 高 |

### 7.5 マイル付与ルール（ChatWork × Zoom統合）

| カテゴリ | アクション | マイル | 日次上限 | 不正防止 |
|---------|----------|-------|---------|---------|
| **ChatWork投稿** | メッセージ投稿 | 5pt/件 | 50pt（10件） | 10文字未満除外 |
| **ChatWork返信** | 他メンバーへの返信 | 8pt/件 | 40pt（5件） | 自己返信除外 |
| **ChatWork引用** | 引用付き返信 | 10pt/件 | 30pt（3件） | - |
| **ChatWorkタスク** | タスク完了 | 15pt/件 | 上限なし | - |
| **ChatWorkファイル** | 資料共有 | 10pt/件 | 30pt（3件） | - |
| **Zoom参加（30-59分）** | グルコン参加 | 50pt | - | duration検証 |
| **Zoom参加（60分+）** | グルコンフル参加 | 100pt | - | duration検証 |
| **Zoom全時間参加** | 開始〜終了まで在席 | 150pt | - | join/leave時刻検証 |
| **Zoom Poll参加** | 投票に参加 | 10pt | - | - |
| **Zoom Poll正答** | 理解度テスト正答 | 20pt/問 | - | - |
| **Zoom Poll全問正解** | 全問正答ボーナス | +50pt | - | - |
| **Zoom Q&A質問** | 質問投稿 | 10pt | - | - |
| **Zoom Q&A回答** | 回答投稿 | 15pt | - | - |
| **Zoom BR参加** | ブレイクアウトルーム参加 | 30pt | - | - |
| **Zoom Survey** | アンケート回答 | 5pt | - | - |
| **見逃し配信視聴** | 録画を最後まで視聴 | 20pt | - | 視聴完了検証 |

### 7.6 API仕様概要

| エンドポイントカテゴリ | 認証 | レート制限 |
|---------------------|------|-----------|
| 認証系（/api/auth/*） | 不要/JWT | 10 req/min/IP |
| マイル系（/api/miles/*） | JWT必須 | 60 req/min/user |
| ランキング系（/api/rankings/*） | JWT必須 | 30 req/min/user |
| 交換系（/api/exchange/*） | JWT必須 | 10 req/min/user |
| イベント系（/api/events/*） | JWT必須 | 30 req/min/user |
| 管理系（/api/admin/*） | JWT必須+admin権限 | 60 req/min/user |

---

## 8. 法的コンプライアンス要件（v2.0追加）

### 8.1 景品表示法対応

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| LEGAL-001 | 交換品価額上限設定 | 交換品の市場価値が取引価額（月額会員費）の20%以下であることをシステムで強制 | 最高 |
| LEGAL-002 | 懸賞上限管理 | ランキング報酬等の懸賞景品は取引価額の20倍以下かつ10万円以下に制限 | 最高 |
| LEGAL-003 | 景品類該当性フラグ | 交換カタログの各商品に景品類該当/非該当フラグを管理画面から設定可能 | 高 |
| LEGAL-004 | 価額表示 | 交換品の市場価値（参考価格）を交換ページに表示 | 高 |
| LEGAL-005 | 法務レビューフロー | 新規交換品追加時に管理者が「景品表示法チェック済み」を確認するチェックボックス | 中 |

### 8.2 資金決済法対応

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| LEGAL-101 | 有償マイル販売禁止（Phase 1） | 初期リリースでは有償マイル購入機能を実装しない | 最高 |
| LEGAL-102 | マイル残高総額モニタリング | 全会員のマイル残高合計をダッシュボードに表示（¥10M超でアラート） | 高 |
| LEGAL-103 | マイル→現金換金禁止 | マイルを現金に換金する機能は一切提供しないことを利用規約に明記 | 最高 |
| LEGAL-104 | マイル有効期限の明示 | マイルの有効期限（12ヶ月）を会員登録時、マイル獲得時、ダッシュボードに明示 | 高 |
| LEGAL-105 | 将来的な有償化時の届出対応 | 有償マイル導入時に財務局への届出が可能なデータ構造（有償/無償の区別） | 中 |

### 8.3 個人情報保護法対応

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| LEGAL-201 | プライバシーポリシー | 収集する個人情報、利用目的、第三者提供先を明示するページ | 最高 |
| LEGAL-202 | Cookie同意バナー | 初回訪問時にCookie利用の同意を取得するバナー表示 | 最高 |
| LEGAL-203 | 分析トラッキングオプトアウト | 会員が分析トラッキングを無効化できる設定画面 | 高 |
| LEGAL-204 | 個人データエクスポート | 会員が自身の個人データ（プロフィール、マイル履歴等）をダウンロード可能 | 中 |
| LEGAL-205 | データ削除権 | 退会時に個人データの完全削除を保証（マイル履歴は匿名化して保持） | 高 |
| LEGAL-206 | 海外サービスへのデータ送信制限 | 個人情報を含むデータの海外送信は同意取得後のみ（Posthog Self-Host推奨） | 高 |

### 8.4 特定商取引法対応

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| LEGAL-301 | 特商法表記ページ | 販売業者名、所在地、連絡先、商品引渡時期、返品ポリシーの表記ページ | 最高 |
| LEGAL-302 | 返品・交換ポリシー | マイル交換品の返品・交換条件を明示（デジタル商品は返品不可等） | 高 |
| LEGAL-303 | 発送時期の明示 | 物理商品の発送予定日を交換確定画面に表示 | 高 |
| LEGAL-304 | マイル失効条件の明示 | マイルの失効条件を利用規約・交換ページに明示 | 高 |

### 8.5 消費者契約法対応

| ID | 要件 | 詳細 | 優先度 |
|----|------|------|--------|
| LEGAL-401 | 利用規約の明確性 | マイルの獲得/消費/失効ルールを一般消費者が理解できる平易な言葉で記載 | 高 |
| LEGAL-402 | 不利益変更の事前通知 | マイル付与ルール変更時は30日以上前に全会員に通知 | 高 |
| LEGAL-403 | クーリングオフ情報 | 有料イベント参加費等に関するクーリングオフ適用有無の明示 | 中 |

---

## 9. セキュリティ要件

### 8.1 認証・認可

| ID | 要件 | 詳細 |
|----|------|------|
| SEC-001 | パスワードポリシー | 最低8文字、大文字小文字数字記号を含む |
| SEC-002 | パスワードハッシュ | bcrypt（コストファクター12以上） |
| SEC-003 | セッション管理 | HTTPOnly + Secure + SameSite=Strict Cookie |
| SEC-004 | CSRF対策 | CSRFトークンによる保護 |
| SEC-005 | レート制限 | エンドポイント別のレート制限（上記参照） |
| SEC-006 | アカウントロック | 5回連続ログイン失敗で30分ロック |
| SEC-007 | JWT有効期限 | アクセストークン:15分 / リフレッシュトークン:30日 |

### 8.2 データ保護

| ID | 要件 | 詳細 |
|----|------|------|
| SEC-101 | 通信暗号化 | 全通信TLS 1.3 |
| SEC-102 | データベース暗号化 | 保存データのAES-256暗号化（Supabaseマネージド） |
| SEC-103 | 個人情報マスキング | 管理画面でのメールアドレス部分表示（a***@example.com） |
| SEC-104 | ログ内の機密情報 | パスワード・トークンはログに記録しない |
| SEC-105 | 環境変数管理 | シークレットは環境変数で管理、コードにハードコード禁止 |

### 8.3 マイル不正防止

| ID | 要件 | 詳細 |
|----|------|------|
| SEC-201 | 同一アクション連打防止 | デバウンス（5秒以内の同一アクションは無視） |
| SEC-202 | API直接呼び出し防止 | サーバーサイドでのアクション検証（クライアント信頼しない） |
| SEC-203 | 異常パターン検出 | 1時間に100マイル以上獲得でアラート |
| SEC-204 | マイル残高整合性チェック | 日次バッチで残高=獲得合計-消費合計を検証 |
| SEC-205 | 監査ログ | 全マイルトランザクションの改ざん不可能な記録 |
| SEC-206 | Race Condition防御（v2.0追加） | SELECT FOR UPDATE + Optimistic Locking + Redis分散ロック + 冪等性キーの4層防御 |
| SEC-207 | 冪等性キー（v2.0追加） | マイル消費APIに冪等性キーを必須とし、リプレイ攻撃を防止 |
| SEC-208 | QRコードワンタイム化（v2.0追加） | イベントQRコードは30秒有効期限+GPS位置検証 |

### 8.4 インフラセキュリティ

| ID | 要件 | 詳細 |
|----|------|------|
| SEC-301 | WAF | Vercel Edge NetworkのDDoS保護 |
| SEC-302 | CSP | Content Security Policyヘッダー設定 |
| SEC-303 | 依存関係脆弱性 | npm audit / Dependabot による自動検出 |
| SEC-304 | OWASP Top 10 | XSS、SQLインジェクション、SSRF等への対策 |
| SEC-305 | ペネトレーションテスト | 本番リリース前に1回、以降年1回実施 |

---

## 10. UI/UX要件

### 9.1 デザインシステム

| 項目 | 仕様 |
|------|------|
| UIライブラリ | shadcn/ui + Tailwind CSS |
| カラーパレット | プライマリ: #6366F1（Indigo）、セカンダリ: #10B981（Emerald） |
| タイポグラフィ | Noto Sans JP（日本語）+ Inter（英数字） |
| アイコン | Lucide Icons |
| アニメーション | Framer Motion（マイル獲得、バッジ獲得、レベルアップ） |
| ダークモード | システム設定連動+手動切替 |

### 9.2 画面一覧

| 画面ID | 画面名 | 説明 | 優先度 |
|--------|--------|------|--------|
| SCR-001 | ログイン/サインアップ | Clerk提供のUIコンポーネント | 最高 |
| SCR-002 | ダッシュボード（ホーム） | マイル残高、ティア、ストリーク、デイリーミッション | 最高 |
| SCR-003 | マイル履歴 | 獲得/消費のトランザクション一覧 | 高 |
| SCR-004 | ランキング | 週間/月間/全期間ランキング表示 | 高 |
| SCR-005 | バッジコレクション | 全バッジ一覧（獲得済/未獲得） | 中 |
| SCR-006 | 交換カタログ | 商品・サービス一覧+交換フロー | 最高 |
| SCR-007 | 交換履歴 | 過去の交換一覧+ステータス確認 | 高 |
| SCR-008 | イベント一覧 | 今後のイベントカレンダー/リスト | 高 |
| SCR-009 | イベント詳細 | イベント詳細+参加登録 | 高 |
| SCR-010 | QRコードスキャナー | カメラ起動+QRスキャン+マイル付与 | 高 |
| SCR-011 | プロフィール | ユーザー情報、バッジ、実績表示 | 高 |
| SCR-012 | プロフィール編集 | ユーザー情報の編集 | 中 |
| SCR-013 | 通知一覧 | 通知の既読/未読一覧 | 高 |
| SCR-014 | 設定 | 通知設定、アカウント設定 | 中 |
| SCR-015 | 友達招待 | 招待リンク生成、招待実績 | 中 |
| SCR-016 | コンテンツ一覧 | 学習コンテンツの一覧 | 高 |
| SCR-017 | コンテンツ詳細 | コンテンツ表示+コメント欄 | 高 |
| SCR-018 | Q&A一覧 | 質問・回答の一覧 | 高 |
| SCR-019 | Q&A詳細 | 質問詳細+回答投稿 | 高 |
| ADM-SCR-001 | 管理ダッシュボード | KPIグラフ、最新アクティビティ | 高 |
| ADM-SCR-002 | 会員管理 | 会員検索・一覧・詳細・編集 | 最高 |
| ADM-SCR-003 | イベント管理 | イベントCRUD | 最高 |
| ADM-SCR-004 | 交換管理 | 交換申請一覧・承認・発送管理 | 高 |
| ADM-SCR-005 | カタログ管理 | 商品CRUD・在庫管理 | 高 |
| ADM-SCR-006 | バッジ管理 | バッジCRUD | 中 |
| ADM-SCR-007 | マイルルール設定 | アクション別マイル値設定 | 高 |
| ADM-SCR-008 | 通知配信 | 一括通知送信 | 中 |
| ADM-SCR-009 | 分析レポート | マイル流通/アクティビティレポート | 中 |
| ADM-SCR-010 | 監査ログ | 管理者操作ログ一覧 | 中 |

### 9.3 マイクロインタラクション

| インタラクション | タイミング | 演出 |
|----------------|-----------|------|
| マイル獲得 | アクション完了時 | 画面上部にトースト通知+カウントアップアニメーション |
| バッジ獲得 | 条件達成時 | フルスクリーンモーダル+パーティクルエフェクト |
| ティア昇格 | 判定時 | フルスクリーンモーダル+新ティアアイコンのアニメーション |
| ストリーク達成 | マイルストーン時 | 炎のアニメーション+ボーナス表示 |
| レベルアップ | XP到達時 | プログレスバーフィル+レベル数字アニメーション |
| ランキング変動 | ページ表示時 | 順位の↑↓アニメーション |
| 交換完了 | マイル消費時 | 商品画像のフライアウト+「おめでとう」表示 |

### 9.4 レスポンシブブレークポイント

| ブレークポイント | 画面幅 | レイアウト |
|----------------|--------|-----------|
| Mobile S | 320px〜374px | 1カラム、ナビゲーションはボトムバー |
| Mobile M | 375px〜424px | 1カラム |
| Mobile L | 425px〜767px | 1カラム |
| Tablet | 768px〜1023px | 2カラム |
| Desktop | 1024px〜1439px | サイドバー+メインコンテンツ |
| Desktop L | 1440px以上 | サイドバー+メインコンテンツ+サブパネル |

---

## 11. 運用・保守要件

### 10.1 監視要件

| 監視項目 | ツール | アラート条件 |
|---------|--------|------------|
| サーバーエラー率 | Sentry | 5xx率が1%を超過 |
| API応答時間 | Vercel Analytics | P95が500msを超過 |
| データベース接続数 | Supabase Dashboard | 接続数が上限の80%到達 |
| Redis メモリ使用量 | Upstash Dashboard | メモリ使用率が80%到達 |
| マイル残高不整合 | 日次バッチ | 不整合レコード検出 |
| 不正アクセス試行 | Clerk Dashboard | 不正ログイン試行の異常増加 |

### 10.2 運用体制

| 役割 | 担当 | 対応時間 |
|------|------|---------|
| システム管理 | 開発チーム | 平日 9:00-18:00 JST |
| 障害対応（P1） | オンコール担当 | 24時間365日 |
| 障害対応（P2-P3） | 開発チーム | 翌営業日 |
| コンテンツ運用 | コミュニティ運営 | 平日 9:00-18:00 JST |
| 会員サポート | サポートチーム | 平日 9:00-18:00 JST |

### 10.3 障害レベル定義

| レベル | 定義 | 対応時間 |
|-------|------|---------|
| P1（緊急） | システム全停止、マイル計算異常 | 1時間以内に復旧開始 |
| P2（重要） | 一部機能停止、パフォーマンス著しい劣化 | 4時間以内に復旧開始 |
| P3（通常） | 軽微な不具合、UIの表示崩れ | 翌営業日に対応 |
| P4（低） | 改善要望、軽微なデザイン調整 | 次回リリースで対応 |

---

## 12. 制約事項・前提条件

### 11.1 制約事項

| ID | 制約 | 影響 |
|----|------|------|
| CON-001 | 予算上限あり | 月額インフラコストは$500以内に収める |
| CON-002 | 開発期間 | 6ヶ月以内にMVPリリース |
| CON-003 | 技術スタック | Next.js + TypeScript + Supabase（変更不可） |
| CON-004 | 日本法規制 | 景品表示法、個人情報保護法、特定商取引法の遵守 |
| CON-005 | モバイルアプリ非対応 | ネイティブアプリは初期スコープ外（PWAで対応） |

### 11.2 前提条件

| ID | 前提 |
|----|------|
| PRE-001 | Vercel、Supabase、Clerk、Stripe のアカウントが利用可能 |
| PRE-002 | ドメインが取得済み |
| PRE-003 | コンテンツ（学習教材等）は別途準備される |
| PRE-004 | 交換カタログの商品・在庫は運営チームが管理する |
| PRE-005 | イベント（グルコン・オフ会）の企画・運営は運営チームが行う |
| PRE-006 | 初期会員データのマイグレーションは必要に応じて別途対応 |

### 11.3 リスク管理

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| Supabase障害 | 高 | 低 | 日次バックアップ、フェイルオーバー手順書 |
| マイル不正取得 | 高 | 中 | 多層防御（レート制限+異常検知+監査ログ） |
| 会員数急増 | 中 | 中 | 自動スケーリング設計、負荷テスト実施 |
| 外部API料金超過 | 中 | 低 | 利用量監視、アラート設定、予算上限設定 |
| 景品表示法違反 | 高 | 低 | 法務レビュー、交換品の価額上限設定 |
| 開発遅延 | 中 | 中 | フェーズ分割、MVP優先、週次進捗管理 |

---

## 13. 用語集

| 用語 | 定義 |
|------|------|
| マイル | コミュニティ独自のポイント通貨。会員のアクションに応じて付与される |
| ティア | 会員ランク。ブロンズ〜ダイヤモンドの5段階 |
| ストリーク | 連続ログイン記録 |
| グルコン | グループコンサルティングの略。オンラインで複数名が参加する相談会 |
| オフ会 | オフラインイベント。対面での交流会 |
| デイリーミッション | 日替わりのタスク。達成でボーナスマイルを獲得 |
| バッジ | 特定の条件達成で獲得できるデジタル証明 |
| 交換カタログ | マイルと交換可能な商品・サービスの一覧 |
| PWA | Progressive Web App。Webサイトをアプリのように利用可能にする技術 |
| SSE | Server-Sent Events。サーバーからクライアントへのリアルタイムデータ配信 |
| RLS | Row Level Security。データベースの行レベルアクセス制御 |
| PITR | Point-in-Time Recovery。任意の時点へのデータベース復旧 |
| ChatWork Bot | ChatWork Webhookを受信して自動応答するプログラム |
| Zoom Poll | Zoom会議中の投票機能。理解度テストに活用 |
| ブレイクアウトルーム | Zoom会議中の少人数グループ分割機能 |
| n8n | オープンソースのワークフロー自動化ツール |
| 見逃し配信 | Zoomクラウドレコーディングによる録画の後日視聴 |

---

## 14. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| プロジェクトオーナー | | | |
| テクニカルリード | | | |
| デザインリード | | | |
| QAリード | | | |

---

**文書履歴**

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|---------|
| 1.0.0 | 2026-02-08 | AI | 初版作成 |
| 2.0.0 | 2026-02-08 | AI | 法的コンプライアンス要件（第8章）追加、セキュリティ要件強化（Race Condition対策等）、外部サービスをPosthog Self-Hostに変更 |
| 3.0.0 | 2026-02-08 | AI | ChatWork API連携（Bot・活動計測・自動通知）、Zoom API連携（参加追跡・Poll・Q&A・録画）、n8nワークフロー自動化、マイル付与ルール統合 |
