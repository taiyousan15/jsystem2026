# セキュリティガイドライン

## 概要

SNS Research Toolのセキュリティ対策と運用ガイドラインです。

## 認証・認可

### JWT認証
- アクセストークン: 15分有効
- リフレッシュトークン: 7日有効
- トークンはHTTPOnlyクッキーまたはlocalStorageに保存

### パスワードポリシー
- 最小8文字
- bcryptでハッシュ化（コスト係数: 12）
- 5回連続失敗で30分間アカウントロック

### セッション管理
- リフレッシュトークンは1回限り使用可能
- ログアウト時にすべてのトークンを無効化

## 入力検証

### バリデーション
- Zodによるスキーマ検証
- SQLインジェクション対策（Prismaパラメータ化クエリ）
- XSS対策（入力サニタイズ）

### レート制限
- 一般API: 15分間に100リクエスト/IP
- 認証API: 15分間に10リクエスト/IP

## データ保護

### 暗号化
- 通信: TLS 1.2/1.3
- パスワード: bcrypt
- センシティブデータ: AES-256

### 個人情報
- メールアドレス、パスワードはログに出力しない
- 監査ログにはIPアドレスとユーザーエージェントのみ記録

## インフラセキュリティ

### ネットワーク
- Dockerネットワーク分離
- 内部サービスは外部公開しない
- Nginxリバースプロキシで保護

### コンテナ
- 非rootユーザーで実行
- 最小権限の原則
- Alpine Linuxベースの軽量イメージ

## セキュリティヘッダー

```
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Content-Security-Policy: default-src 'self'
Strict-Transport-Security: max-age=63072000
```

## 脆弱性対応

### 依存関係
- `npm audit` を定期実行
- Dependabot による自動更新
- 高・クリティカルな脆弱性は即時対応

### インシデント対応
1. 影響範囲の特定
2. 一時的な緩和策の実施
3. 根本原因の分析
4. 恒久対策の実施
5. 再発防止策の策定

## 監査ログ

### 記録項目
- タイムスタンプ
- ユーザーID
- アクション種別
- IPアドレス
- ユーザーエージェント
- 結果（成功/失敗）

### 保持期間
- 認証ログ: 1年
- 操作ログ: 90日
- エラーログ: 30日

## セキュリティチェックリスト

### デプロイ前
- [ ] 環境変数に本番用シークレットを設定
- [ ] JWT_SECRETを強力なランダム値に変更
- [ ] DATABASE_URLのパスワードを変更
- [ ] REDIS_PASSWORDを設定
- [ ] TLS証明書を設定
- [ ] CORSオリジンを本番ドメインに限定
- [ ] デバッグログを無効化

### 運用時
- [ ] 定期的なセキュリティスキャン
- [ ] アクセスログの監視
- [ ] 異常なログインパターンの検知
- [ ] 依存関係の更新

## 連絡先

セキュリティに関する問題を発見した場合は、以下に報告してください：
- Email: security@example.com
- 重大な脆弱性の場合は非公開で報告してください
